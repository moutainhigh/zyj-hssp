<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.hand.hec.exp.mapper.ExpRequisitionLineMapper">
    <resultMap id="BaseResultMap" type="com.hand.hec.exp.dto.ExpRequisitionLine">
        <result column="PLACE_TYPE_ID" property="placeTypeId" jdbcType="DECIMAL"/>
        <result column="PLACE_TYPE_NAME" property="placeTypeName" jdbcType="VARCHAR"/>
        <result column="PLACE_ID" property="placeId" jdbcType="DECIMAL"/>
        <result column="PLACE_NAME" property="placeName" jdbcType="VARCHAR"/>
        <result column="CITY" property="city" jdbcType="VARCHAR"/>
        <result column="DESCRIPTION" property="description" jdbcType="VARCHAR"/>
        <result column="DATE_FROM" property="dateFrom" jdbcType="DATE"/>
        <result column="DATE_TO" property="dateTo" jdbcType="DATE"/>
        <result column="PERIOD_NAME" property="periodName" jdbcType="VARCHAR"/>
        <result column="BUSINESS_CURRENCY_CODE" property="businessCurrencyCode" jdbcType="VARCHAR"/>
        <result column="BUSINESS_CURRENCY_NAME" property="businessCurrencyName" jdbcType="VARCHAR"/>
        <result column="BIZ2PAY_EXCHANGE_TYPE" property="biz2payExchangeType" jdbcType="VARCHAR"/>
        <result column="BIZ2PAY_EXCHANGE_TYPE_NAME" property="biz2payExchangeTypeName" jdbcType="VARCHAR"/>
        <result column="BIZ2PAY_EXCHANGE_RATE" property="biz2payExchangeRate" jdbcType="DECIMAL"/>
        <result column="PAYMENT_CURRENCY_CODE" property="paymentCurrencyCode" jdbcType="VARCHAR"/>
        <result column="PAYMENT_CURRENCY_NAME" property="paymentCurrencyName" jdbcType="VARCHAR"/>
        <result column="PAY2FUN_EXCHANGE_TYPE" property="pay2funExchangeType" jdbcType="VARCHAR"/>
        <result column="PAY2FUN_EXCHANGE_TYPE_NAME" property="pay2funExchangeTypeName" jdbcType="VARCHAR"/>
        <result column="PAY2FUN_EXCHANGE_RATE" property="pay2funExchangeRate" jdbcType="DECIMAL"/>
        <result column="MANAGEMENT_CURRENCY_CODE" property="managementCurrencyCode" jdbcType="VARCHAR"/>
        <result column="MANAGEMENT_CURRENCY_NAME" property="managementCurrencyName" jdbcType="VARCHAR"/>
        <result column="PAY2MAG_EXCHANGE_TYPE" property="pay2magExchangeType" jdbcType="VARCHAR"/>
        <result column="PAY2MAG_EXCHANGE_TYPE_NAME" property="pay2magExchangeTypeName" jdbcType="VARCHAR"/>
        <result column="PAY2MAG_EXCHANGE_RATE" property="pay2magExchangeRate" jdbcType="DECIMAL"/>
        <result column="MO_EXPENSE_TYPE_ID" property="moExpenseTypeId" jdbcType="DECIMAL"/>
        <result column="MO_EXPENSE_TYPE_NAME" property="moExpenseTypeName" jdbcType="VARCHAR"/>
        <result column="MO_REQ_ITEM_ID" property="moReqItemId" jdbcType="DECIMAL"/>
        <result column="MO_REQ_ITEM_NAME" property="moReqItemName" jdbcType="VARCHAR"/>
        <result column="BUDGET_ITEM_ID" property="budgetItemId" jdbcType="DECIMAL"/>
        <result column="BUDGET_ITEM_NAME" property="budgetItemName" jdbcType="VARCHAR"/>
        <result column="BUSINESS_PRICE" property="businessPrice" jdbcType="DECIMAL"/>
        <result column="PAYMENT_PRICE" property="paymentPrice" jdbcType="DECIMAL"/>
        <result column="MANAGEMENT_PRICE" property="managementPrice" jdbcType="DECIMAL"/>
        <result column="PRIMARY_QUANTITY" property="primaryQuantity" jdbcType="DECIMAL"/>
        <result column="PRIMARY_UOM" property="primaryUom" jdbcType="VARCHAR"/>
        <result column="SECONDARY_QUANTITY" property="secondaryQuantity" jdbcType="DECIMAL"/>
        <result column="SECONDARY_UOM" property="secondaryUom" jdbcType="VARCHAR"/>
        <result column="BUSINESS_AMOUNT" property="businessAmount" jdbcType="DECIMAL"/>
        <result column="PAYMENT_AMOUNT" property="paymentAmount" jdbcType="DECIMAL"/>
        <result column="MANAGEMENT_AMOUNT" property="managementAmount" jdbcType="DECIMAL"/>
        <result column="REQUISITION_FUNCTIONAL_AMOUNT" property="requisitionFunctionalAmount" jdbcType="DECIMAL"/>
        <result column="DISTRIBUTION_SET_ID" property="distributionSetId" jdbcType="DECIMAL"/>
        <result column="COMPANY_ID" property="companyId" jdbcType="DECIMAL"/>
        <result column="COMPANY_NAME" property="companyName" jdbcType="VARCHAR"/>
        <result column="OPERATION_UNIT_ID" property="operationUnitId" jdbcType="DECIMAL"/>
        <result column="UNIT_ID" property="unitId" jdbcType="DECIMAL"/>
        <result column="UNIT_NAME" property="unitName" jdbcType="VARCHAR"/>
        <result column="POSITION_ID" property="positionId" jdbcType="DECIMAL"/>
        <result column="POSITION_NAME" property="positionName" jdbcType="VARCHAR"/>
        <result column="EMPLOYEE_ID" property="employeeId" jdbcType="DECIMAL"/>
        <result column="EMPLOYEE_NAME" property="employeeName" jdbcType="VARCHAR"/>
        <result column="ACC_ENTITY_ID" property="accEntityId" jdbcType="DECIMAL"/>
        <result column="ACC_ENTITY_NAME" property="accEntityName" jdbcType="VARCHAR"/>
        <result column="RESP_CENTER_ID" property="respCenterId" jdbcType="DECIMAL"/>
        <result column="RESP_CENTER_NAME" property="respCenterName" jdbcType="VARCHAR"/>
        <result column="BGT_ENTITY_ID" property="bgtEntityId" jdbcType="DECIMAL"/>
        <result column="BGT_ENTITY_NAME" property="bgtEntityName" jdbcType="VARCHAR"/>
        <result column="BGT_CENTER_ID" property="bgtCenterId" jdbcType="DECIMAL"/>
        <result column="BGT_CENTER_NAME" property="bgtCenterName" jdbcType="VARCHAR"/>
        <result column="PAYEE_CATEGORY" property="payeeCategory" jdbcType="VARCHAR"/>
        <result column="PAYEE_CATEGORY_NAME" property="payeeCategoryName" jdbcType="VARCHAR"/>
        <result column="PAYEE_ID" property="payeeId" jdbcType="DECIMAL"/>
        <result column="PAYEE_NAME" property="payeeName" jdbcType="VARCHAR"/>
        <result column="PAYMENT_FLAG" property="paymentFlag" jdbcType="VARCHAR"/>
        <result column="REQUISITION_STATUS" property="requisitionStatus" jdbcType="VARCHAR"/>
        <result column="AUDIT_FLAG" property="auditFlag" jdbcType="VARCHAR"/>
        <result column="ATTACHMENT_NUM" property="attachmentNum" jdbcType="DECIMAL"/>
        <result column="DIMENSION1_ID" property="dimension1Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION2_ID" property="dimension2Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION3_ID" property="dimension3Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION4_ID" property="dimension4Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION5_ID" property="dimension5Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION6_ID" property="dimension6Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION7_ID" property="dimension7Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION8_ID" property="dimension8Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION9_ID" property="dimension9Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION10_ID" property="dimension10Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION11_ID" property="dimension11Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION12_ID" property="dimension12Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION13_ID" property="dimension13Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION14_ID" property="dimension14Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION15_ID" property="dimension15Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION16_ID" property="dimension16Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION17_ID" property="dimension17Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION18_ID" property="dimension18Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION19_ID" property="dimension19Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION20_ID" property="dimension20Id" jdbcType="DECIMAL"/>
        <result column="DIMENSION1_NAME" property="dimension1Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION2_NAME" property="dimension2Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION3_NAME" property="dimension3Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION4_NAME" property="dimension4Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION5_NAME" property="dimension5Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION6_NAME" property="dimension6Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION7_NAME" property="dimension7Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION8_NAME" property="dimension8Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION9_NAME" property="dimension9Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION10_NAME" property="dimension10Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION11_NAME" property="dimension11Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION12_NAME" property="dimension12Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION13_NAME" property="dimension13Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION14_NAME" property="dimension14Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION15_NAME" property="dimension15Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION16_NAME" property="dimension16Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION17_NAME" property="dimension17Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION18_NAME" property="dimension18Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION19_NAME" property="dimension19Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION20_NAME" property="dimension20Name" jdbcType="VARCHAR"/>
        <result column="DIMENSION1_LEVEL" property="dimension1Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION2_LEVEL" property="dimension2Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION3_LEVEL" property="dimension3Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION4_LEVEL" property="dimension4Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION5_LEVEL" property="dimension5Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION6_LEVEL" property="dimension6Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION7_LEVEL" property="dimension7Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION8_LEVEL" property="dimension8Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION9_LEVEL" property="dimension9Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION10_LEVEL" property="dimension10Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION11_LEVEL" property="dimension11Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION12_LEVEL" property="dimension12Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION13_LEVEL" property="dimension13Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION14_LEVEL" property="dimension14Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION15_LEVEL" property="dimension15Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION16_LEVEL" property="dimension16Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION17_LEVEL" property="dimension17Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION18_LEVEL" property="dimension18Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION19_LEVEL" property="dimension19Level" jdbcType="VARCHAR"/>
        <result column="DIMENSION20_LEVEL" property="dimension20Level" jdbcType="VARCHAR"/>
        <result column="ENTERTAIN_OBJECT" property="entertainObject" jdbcType="VARCHAR"/>
        <result column="ENTERTAIN_NUMBER" property="entertainNumber" jdbcType="DECIMAL"/>
        <result column="EXP_REQUISITION_LINE_ID" property="expRequisitionLineId" jdbcType="DECIMAL"/>
        <result column="EXP_REQUISITION_HEADER_ID" property="expRequisitionHeaderId" jdbcType="DECIMAL"/>
        <result column="LINE_NUMBER" property="lineNumber" jdbcType="DECIMAL"/>
        <result column="REQ_PAGE_ELEMENT_CODE" property="reqPageElementCode" jdbcType="VARCHAR"/>
        <result column="CLOSED_DATE" property="closedDate" jdbcType="VARCHAR"/>

        <result column="TRAVEL_LINE_ID" property="travelLineId" jdbcType="DECIMAL"/>
        <result column="TRAVEL_LINE_CATEGORY" property="travelLineCategory" jdbcType="VARCHAR"/>
        <result column="TRANSPORTATION" property="transportation" jdbcType="VARCHAR"/>
        <result column="TRANSPORTATION_NAME" property="transportationName" jdbcType="VARCHAR"/>
        <result column="SEAT_CLASS" property="seatClass" jdbcType="VARCHAR"/>
        <result column="SEAT_CLASS_NAME" property="seatClassName" jdbcType="VARCHAR"/>
        <result column="DEPARTURE_PLACE_NAME" property="departurePlaceName" jdbcType="VARCHAR"/>
        <result column="DEPARTURE_PLACE_ID" property="departurePlaceId" jdbcType="DECIMAL"/>
        <result column="DEPARTURE_DATE" property="departureDate" jdbcType="DATE"/>
        <result column="ARRIVAL_PLACE_ID" property="arrivalPlaceId" jdbcType="DECIMAL"/>
        <result column="ARRIVAL_PLACE_NAME" property="arrivalPlaceName" jdbcType="VARCHAR"/>
        <result column="ARRIVAL_DATE" property="arrivalDate" jdbcType="DATE"/>
        <result column="ACCOMMODATION_DATE_FROM" property="accommodationDateFrom" jdbcType="DATE"/>
        <result column="ACCOMMODATION_DATE_TO" property="accommodationDateTo" jdbcType="DATE"/>
        <result column="ACCOMMODATION_DAYS" property="accommodationDays" jdbcType="DECIMAL"/>
        <result column="PEER_PEOPLE_NAME" property="peerPeopleName" jdbcType="VARCHAR"/>
        <result column="MONOPOLIZE_FLAG" property="monopolizeFlag" jdbcType="VARCHAR"/>
        <result column="EXPENSE_STANDARD" property="expenseStandard" jdbcType="DECIMAL"/>
        <result column="UPPER_LIMIT" property="upperLimit" jdbcType="DECIMAL"/>
        <result column="LOWER_LIMIT" property="lowerLimit" jdbcType="DECIMAL"/>
        <result column="COMMIT_FLAG" property="commitFlag" jdbcType="VARCHAR"/>
        <result column="MO_EXP_REQ_TYPE_ID" property="moExpReqTypeId" jdbcType="DECIMAL"/>
        <result column="CHANGEABLE_FLAG" property="changeableFlag" jdbcType="VARCHAR"/>
    </resultMap>
    <select id="expReqLineQuery" resultMap="BaseResultMap">
            select erl.EXP_REQUISITION_HEADER_ID,
            (select erh.MO_EXP_REQ_TYPE_ID
            from exp_requisition_header erh
            where erh.exp_requisition_header_id=erl.EXP_REQUISITION_HEADER_ID)MO_EXP_REQ_TYPE_ID,
       erl.EXP_REQUISITION_LINE_ID,
			 erl.LINE_NUMBER,
			 erl.REQ_PAGE_ELEMENT_CODE,
			 erl.PLACE_ID,
			(select
			eppt.DESCRIPTION
			from exp_policy_place_tl eppt
			where eppt.PLACE_ID=erl.PLACE_ID
			and eppt.LANG=#{request.locale})place_name,
      erl.place_type_id,
			(select
			epptt.DESCRIPTION
			from exp_policy_place_type_tl epptt
			where epptt.PLACE_TYPE_ID=erl.PLACE_TYPE_ID
			and epptt.LANG=#{request.locale})place_type_name,
			erl.city,
			erl.DESCRIPTION,
			date_format( erl.date_from, '%Y-%m-%d' )date_from,
			date_format( erl.date_to, '%Y-%m-%d' )date_to,
			erl.PERIOD_NAME,
			erl.BUSINESS_CURRENCY_CODE,
			(SELECT  gct.currency_name
		 FROM   gld_currency gc
		 LEFT JOIN gld_currency_tl gct
		 ON gc.currency_id = gct.currency_id
		 AND gct.lang = #{request.locale}
		 WHERE gc.currency_code = erl.BUSINESS_CURRENCY_CODE)BUSINESS_CURRENCY_NAME,
		 (SELECT gc.FINANCE_PRECISION
		 FROM gld_currency gc
		 WHERE gc.CURRENCY_CODE = erl.BUSINESS_CURRENCY_CODE)business_currency_precision,
		 erl.biz2pay_exchange_type,
		 (select
		 ett.DESCRIPTION
		 from gld_exchangerate_type et left join gld_exchangerate_type_tl ett on
		 et.TYPE_ID=ett.TYPE_ID and ett.LANG=#{request.locale}
		 where et.TYPE_CODE=erl.biz2pay_exchange_type)biz2pay_exchange_type_name,
		 erl.biz2pay_exchange_rate,
     erl.payment_currency_code,
		 (SELECT  gct.currency_name
		 FROM   gld_currency gc
		 LEFT JOIN gld_currency_tl gct
		 ON gc.currency_id = gct.currency_id
		 AND gct.lang = #{request.locale}
		 WHERE gc.currency_code = erl.payment_currency_code)payment_currency_name,
		 (SELECT gc.FINANCE_PRECISION
		 FROM gld_currency gc
		 WHERE gc.CURRENCY_CODE = erl.payment_currency_code)payment_currency_precision,
		 erl.pay2fun_exchange_type,
		 (select
		 ett.DESCRIPTION
		 from gld_exchangerate_type et left join gld_exchangerate_type_tl ett on
		 et.TYPE_ID=ett.TYPE_ID and ett.LANG=#{request.locale}
		 where et.TYPE_CODE=erl.pay2fun_exchange_type)pay2fun_exchange_type_name,
		 erl.pay2fun_exchange_rate,
		 erl.management_currency_code,
		 (SELECT  gct.currency_name
		 FROM   gld_currency gc
		 LEFT JOIN gld_currency_tl gct
		 ON gc.currency_id = gct.currency_id
		 AND gct.lang = #{request.locale}
		 WHERE gc.currency_code = erl.management_currency_code)management_currency_name,
		 (SELECT gc.FINANCE_PRECISION
		 FROM gld_currency gc
		 WHERE gc.CURRENCY_CODE = erl.management_currency_code)management_currency_precision,
		  erl.pay2mag_exchange_type,
			(select
		 ett.DESCRIPTION
		 from gld_exchangerate_type et left join gld_exchangerate_type_tl ett on
		 et.TYPE_ID=ett.TYPE_ID and ett.LANG=#{request.locale}
		 where et.TYPE_CODE=erl.pay2mag_exchange_type)pay2mag_exchange_type_name,
		 erl.pay2mag_exchange_rate,
		 erl.mo_expense_type_id,
		 (select
		 ett.DESCRIPTION
		 from exp_mo_expense_type_tl ett
		 where ett.LANG=#{request.locale}
		 and ett.MO_EXPENSE_TYPE_ID=erl.MO_EXPENSE_TYPE_ID)mo_expense_type_name,
		 erl.mo_req_item_id,
		 (select
		 rit.DESCRIPTION
		 from exp_mo_req_item_tl rit
		 where rit.LANG=#{request.locale}
		 and rit.MO_REQ_ITEM_ID=erl.MO_REQ_ITEM_ID)mo_req_item_name,
		 erl.budget_item_id,
		 (select
		 bit.DESCRIPTION
		 from bgt_budget_item_tl bit
		 where bit.LANG=#{request.locale}
		 and bit.BUDGET_ITEM_ID=erl.BUDGET_ITEM_ID)budget_item_name,
		 erl.business_price,
     erl.payment_price,
     erl.management_price,
     erl.primary_quantity,
     erl.primary_uom,
     erl.secondary_quantity,
     erl.secondary_uom,
     erl.business_amount,
     erl.payment_amount,
     erl.management_amount,
     erl.requisition_functional_amount,
     erl.distribution_set_id,
     erl.company_id,
		 ( SELECT
	    fct.company_short_name
     FROM
	    fnd_company fc
	   LEFT JOIN fnd_company_tl fct ON fc.company_id = fct.company_id
	   AND fct.LANG = #{request.locale}
     WHERE fc.COMPANY_ID = erl.COMPANY_ID) AS company_name,
		 erl.operation_unit_id,
     erl.unit_id,
		 (select eout.DESCRIPTION
	from exp_org_unit eou left join exp_org_unit_tl eout
	on eou.UNIT_ID=eout.UNIT_ID and eout.LANG=#{request.locale}
	where eou.UNIT_ID=erl.UNIT_ID)UNIT_NAME,
		 erl.position_id,
		 (select eopt.DESCRIPTION
	from exp_org_position eop left join exp_org_position_tl eopt
	on eopt.POSITION_ID=eop.POSITION_ID and eopt.LANG=#{request.locale}
	where eop.POSITION_ID=erl.POSITION_ID
	)POSITION_NAME,
	erl.EMPLOYEE_ID,
	(SELECT ee.`NAME`
	    FROM  exp_employee ee
	    WHERE ee.EMPLOYEE_ID = erl.EMPLOYEE_ID)employee_name,
			erl.acc_entity_id,
			(SELECT gaet.ACC_ENTITY_NAME
		FROM  gld_accounting_entity_tl gaet
		WHERE gaet.ACC_ENTITY_ID = erl.ACC_ENTITY_ID
        AND gaet.LANG = #{request.locale})acc_entity_name,
				erl.resp_center_id,
				(
        SELECT
        grct.RESPONSIBILITY_CENTER_NAME
        FROM
        gld_responsibility_center grc
        LEFT JOIN gld_responsibility_center_tl grct ON grc.RESPONSIBILITY_CENTER_ID = grct.RESPONSIBILITY_CENTER_ID
        AND grct.LANG = #{request.locale}
        WHERE
        grc.RESPONSIBILITY_CENTER_ID = erl.resp_center_id
        ) AS resp_center_name,
				erl.bgt_entity_id,
				(
        SELECT
        bet.DESCRIPTION
        FROM
        bgt_entity be
        LEFT JOIN bgt_entity_tl bet ON be.ENTITY_ID = bet.ENTITY_ID
        AND bet.LANG = #{request.locale}
        WHERE
        be.ENTITY_ID = erl.bgt_entity_id
        ) AS bgt_entity_name,
				erl.bgt_center_id,
				(
        SELECT
        bct.DESCRIPTION
        FROM
        bgt_center bc
        LEFT JOIN bgt_center_tl bct ON bc.CENTER_ID = bct.CENTER_ID
        AND bct.LANG = #{request.locale}
        WHERE
        bc.CENTER_ID = erl.bgt_center_id
        ) AS bgt_center_name,
				erl.payee_category,
				(
        SELECT
        scvt.MEANING
        FROM
        sys_code_b scb
        INNER JOIN sys_code_value_b scvb ON scb.CODE_ID = scvb.CODE_ID
        INNER JOIN sys_code_value_tl scvt ON scvb.CODE_VALUE_ID = scvt.CODE_VALUE_ID
        AND scvt.LANG = #{request.locale}
        AND scb.`CODE` = 'PAYMENT_OBJECT'
        WHERE
        scvb.`VALUE` = erl.payee_category
        ) AS payee_category_name,
				erl.payee_id,
				(
        CASE

        WHEN erl.payee_category = 'EMPLOYEE' THEN
        ( SELECT ees.`NAME` FROM exp_employee ees WHERE ees.employee_id = erl.payee_id )
        WHEN erl.payee_category = 'VENDER' THEN
        (
        SELECT
        psvt.DESCRIPTION
        FROM
        pur_system_vender psv
        LEFT JOIN pur_system_vender_tl psvt ON psv.VENDER_ID = psvt.VENDER_ID
        AND psvt.LANG = #{request.locale}
        WHERE
        psv.VENDER_ID = erl.payee_id
        )
        WHEN erl.payee_category = 'CUSTOMER' THEN
        (
        SELECT
        osct.DESCRIPTION
        FROM
        ord_system_customer osc
        LEFT JOIN ord_system_customer_tl osct ON osc.CUSTOMER_ID = osct.CUSTOMER_ID
        AND osct.LANG = #{request.locale}
        WHERE
        osc.CUSTOMER_ID = erl.payee_id
        ) ELSE ''
        END
        ) AS payee_name,
				erl.payment_flag,
                    erl.requisition_status,
                    erl.audit_flag,
                    erl.attachment_num,
                    erl.dimension1_id,
                    erl.dimension2_id,
                    erl.dimension3_id,
                    erl.dimension4_id,
                    erl.dimension5_id,
                    erl.dimension6_id,
                    erl.dimension7_id,
                    erl.dimension8_id,
                    erl.dimension9_id,
                    erl.dimension10_id,
                    erl.dimension11_id,
                    erl.dimension12_id,
                    erl.dimension13_id,
                    erl.dimension14_id,
                    erl.dimension15_id,
                    erl.dimension16_id,
                    erl.dimension17_id,
                    erl.dimension18_id,
                    erl.dimension19_id,
                    erl.dimension20_id,
				            (SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION1_ID)dimension1_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION2_ID)dimension2_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION3_ID)dimension3_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION4_ID)dimension4_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION5_ID)dimension5_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION6_ID)dimension6_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION7_ID)dimension7_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION8_ID)dimension8_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION9_ID)dimension9_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION10_ID)dimension10_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION11_ID)dimension11_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION12_ID)dimension12_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION13_ID)dimension13_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION14_ID)dimension14_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION15_ID)dimension15_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION16_ID)dimension16_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION17_ID)dimension17_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION18_ID)dimension18_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION19_ID)dimension19_name,
										(SELECT
	fdvt.DESCRIPTION
FROM
	fnd_dimension_value fdv
	LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID
	AND fdvt.lang = #{request.locale}
WHERE
	fdv.DIMENSION_VALUE_ID = erl.DIMENSION20_ID)dimension20_name,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='1'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='1'))dimension1_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='2'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='2'))dimension2_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='3'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='3'))dimension3_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='4'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='4'))dimension4_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='5'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='5'))dimension5_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='6'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='6'))dimension6_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='7'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='7'))dimension7_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='8'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='8'))dimension8_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='9'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='9'))dimension9_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='10'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='10'))dimension10_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='11'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='11'))dimension11_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='12'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='12'))dimension12_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='13'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='13'))dimension13_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='14'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='14'))dimension14_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='15'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='15'))dimension15_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='16'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='16'))dimension16_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='17'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='17'))dimension17_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='18'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='18'))dimension18_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='19'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='19'))dimension19_level,
										IFNULL ((select
										fds.COMPANY_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='20'),(select
										fds.SYSTEM_LEVEL
										from fnd_dimension fds
										where fds.DIMENSION_SEQUENCE='20'))dimension20_level,
										ertl.travel_line_id,
										ertl.travel_line_category,
										ertl.transportation,
										(SELECT
                      scvt.MEANING
                    FROM
                      sys_code_b scb
                   INNER JOIN sys_code_value_b scvb ON scb.CODE_ID = scvb.CODE_ID
                   INNER JOIN sys_code_value_tl scvt ON scvb.CODE_VALUE_ID = scvt.CODE_VALUE_ID
        AND scvt.LANG = #{request.locale}
        AND scb.`CODE` = 'TRANSPORTATION'
        WHERE
        scvb.`VALUE` = ertl.transportation)transportation_name,
				ertl.seat_class,
				(case ertl.transportation when 'SEATS_HSR_EMU' then
				(select scvv.MEANING
				from sys_code_value_vl scvv
				where scvv.`CODE`='SEATS_HSR_EMU'
				and scvv.`VALUE`=ertl.seat_class)
				when 'SEATS_CAR' then(select scvv.MEANING
				from sys_code_value_vl scvv
				where scvv.`CODE`='SEATS_CAR'
				and scvv.`VALUE`=ertl.seat_class)

				when 'SEATS_PLANE' then (select scvv.MEANING
				from sys_code_value_vl scvv
				where scvv.`CODE`='SEATS_PLANE'
				and scvv.`VALUE`=ertl.seat_class)

				when 'SEATS_SHIPS' then(select scvv.MEANING
				from sys_code_value_vl scvv
				where scvv.`CODE`='SEATS_SHIPS'
				and scvv.`VALUE`=ertl.seat_class)

				when 'SEATS_TRAIN' then(select scvv.MEANING
				from sys_code_value_vl scvv
				where scvv.`CODE`='SEATS_TRAIN'
				and scvv.`VALUE`=ertl.seat_class)
				else ''
				end) as seat_class_name,
				ertl.departure_place departure_place_name,
				ertl.departure_place_id,
				date_format( ertl.departure_date, '%Y-%m-%d' )departure_date,
				ertl.arrival_place arrival_place_name,
        ertl.arrival_place_id,
				date_format( ertl.arrival_date, '%Y-%m-%d' )arrival_date,
				date_format( ertl.accommodation_date_from, '%Y-%m-%d' )accommodation_date_from,
				date_format( ertl.accommodation_date_to, '%Y-%m-%d' )accommodation_date_to,
				ertl.accommodation_days,
                    ertl.peer_people peer_people_name,
                    erl.entertain_object,
                    erl.entertain_number,
                    ertl.monopolize_flag,
                   null changeable_flag,
                    null expense_standard,
                     null upper_limit,
                     null lower_limit,
                     null commit_flag
from exp_requisition_line erl left join
	exp_requisition_travel_line ertl
	on erl.EXP_REQUISITION_LINE_ID=ertl.EXP_REQUISITION_LINE_ID
where  erl.EXP_REQUISITION_HEADER_ID=#{expRequisitionHeaderId}

    </select>
    <select id="queryDetailLine" parameterType="java.lang.Long" resultMap="BaseResultMap">
      SELECT
	date_format(
		ifnull(d.close_date,now()),
		'%Y-%m-%d'
	) closed_date,
	l.line_number,
	l.description,
	(select tv.description
      from exp_mo_expense_type tv
     where tv.mo_expense_type_id = l.mo_expense_type_id) mo_expense_type_name,
	(select iv.description
      from exp_mo_req_item iv
     where iv.mo_req_item_id = l.mo_req_item_id) mo_req_item_name,
	(select u.description
      from exp_org_unit u
     where u.unit_id = l.unit_id) unit_name,
	l.business_price,
	l.primary_quantity,
	l.business_amount,
	l.period_name,
	l.exp_requisition_line_id,
	l.exp_requisition_header_id,
	l.req_page_element_code,
	l.place_type_id,
	l.place_id,
	l.city,
	l.date_from,
	l.date_to,
	l.business_currency_code,
	l.biz2pay_exchange_type,
	l.biz2pay_exchange_rate,
	l.payment_currency_code,
	l.pay2fun_exchange_type,
	l.pay2fun_exchange_rate,
	l.management_currency_code,
	l.pay2mag_exchange_type,
	l.pay2mag_exchange_rate,
	l.budget_item_id,
	l.payment_price,
	l.management_price,
	l.primary_uom,
	l.secondary_quantity,
	l.secondary_uom,
	l.payment_amount,
	l.management_amount,
	l.requisition_functional_amount,
	l.distribution_set_id,
	l.company_id,
	l.operation_unit_id,
	l.position_id,
	l.employee_id,
	l.acc_entity_id,
	l.resp_center_id,
	l.bgt_entity_id,
	l.bgt_center_id,
	l.payee_category,
	l.payee_id,
	l.payment_flag,
	l.requisition_status,
	l.audit_flag,
	l.attachment_num,
	l.dimension1_id,
	l.dimension2_id,
	l.dimension3_id,
	l.dimension4_id,
	l.dimension5_id,
	l.dimension6_id,
	l.dimension7_id,
	l.dimension8_id,
	l.dimension9_id,
	l.dimension10_id,
	l.dimension11_id,
	l.dimension12_id,
	l.dimension13_id,
	l.dimension14_id,
	l.dimension15_id,
	l.dimension16_id,
	l.dimension17_id,
	l.dimension18_id,
	l.dimension19_id,
	l.dimension20_id,
	l.creation_date,
	l.created_by,
	l.last_updated_by,
	l.last_update_date,
	l.entertain_object,
	l.entertain_number
FROM
	exp_requisition_line l,
	exp_requisition_dist d
WHERE
	d.exp_requisition_line_id = l.exp_requisition_line_id
    AND d.close_flag = 'N'
    AND l.exp_requisition_header_id = #{headId}
    </select>

    <select id="expReportFromReqQuery" resultType="java.util.Map">
        SELECT
                        h.exp_requisition_header_id as expRequisitionHeaderId,
                        d.exp_requisition_line_id as expRequisitionLineId,
                        d.exp_requisition_dist_id as expRequisitionDistId,
                        h.exp_requisition_number as expRequisitionNumber,
                        l.line_number as lineNumber,
                        d.description,
                        d.company_id as companyId,
                        (SELECT fct.company_short_name FROM fnd_company fc LEFT JOIN fnd_company_tl fct ON fc.company_id = fct.company_id and fct.LANG = #{request.locale} where fc.COMPANY_ID = d.company_id) AS companyName,
                        d.acc_entity_id as accEntityId,
                        (SELECT gaet.acc_entity_name FROM gld_accounting_entity gae LEFT JOIN gld_accounting_entity_tl gaet ON gae.ACC_ENTITY_ID = gaet.ACC_ENTITY_ID  AND gaet.LANG = #{request.locale} where gae.ACC_ENTITY_ID = d.acc_entity_id) AS accEntityName,
                        d.unit_id as unitId,
                        (SELECT eout.description FROM exp_org_unit eou LEFT JOIN exp_org_unit_tl eout ON eou.unit_id = eout.unit_id AND eout.lang = #{request.locale} WHERE eou.unit_id = d.unit_id) AS unitName,
                        d.position_id as positionId,
                        (SELECT eopt.description FROM exp_org_position eop LEFT JOIN exp_org_position_tl eopt ON eop.position_id = eopt.position_id AND eopt.lang = #{request.locale} WHERE eop.position_id = d.position_id) AS positionName,
                        d.employee_id as employeeId,
                        (select ee.name from exp_employee ee where ee.employee_id = d.employee_id) AS employeeName,
                        d.resp_center_id as respCenterId,
                        (SELECT grct.responsibility_center_name FROM gld_responsibility_center grc LEFT JOIN gld_responsibility_center_tl grct ON grc.RESPONSIBILITY_CENTER_ID = grct.RESPONSIBILITY_CENTER_ID AND grct.LANG = #{request.locale} where grct.RESPONSIBILITY_CENTER_ID = d.resp_center_id) AS respCenterName,
                        l.place_type_id as placeTypeId,
                        (select ept.DESCRIPTION from exp_policy_place_type ep left join exp_policy_place_type_tl ept on ep.PLACE_TYPE_ID = ept.PLACE_TYPE_ID and ept.LANG = #{request.locale} where ep.PLACE_TYPE_ID = l.place_type_id) AS placeTypeName,
                        l.place_id as placeId,
                        (select ept.DESCRIPTION from exp_policy_place ep left join exp_policy_place_tl ept on ep.PLACE_ID = ept.PLACE_ID and ept.LANG = #{request.locale} where ep.PLACE_ID = l.place_id) AS placeName,
                        d.budget_item_id as budgetItemId,
                        (select bit.DESCRIPTION from bgt_budget_item bi left join bgt_budget_item_tl bit on bi.BUDGET_ITEM_ID = bit.BUDGET_ITEM_ID and bit.LANG = #{request.locale} where bi.BUDGET_ITEM_ID = d.budget_item_id) AS budgetItemName,
                        DATE_FORMAT(d.date_from, '%Y-%m-%d') AS dateFrom,
                        DATE_FORMAT(d.date_to, '%Y-%m-%d') AS dateTo,
                        d.period_name as periodName,
						(case when #{reportPageElementCode} is null then (select et.mo_expense_type_id
							from exp_mo_report_type        rt,
								 exp_mo_rep_type_ref_ele   re,
								 exp_report_page_element   e,
								 exp_mo_rep_ele_ref_exp_tp et,
								 exp_req_page_element      erp
						   where rt.mo_exp_report_type_id = #{moExpReportTypeId}
								 and rt.mo_exp_report_type_id = re.mo_exp_report_type_id
								 and re.report_page_element_id = e.report_page_element_id
								 and re.rep_page_ele_ref_id = et.rep_page_ele_ref_id
								 and erp.req_page_element_id = e.req_page_element_id
								 and et.mo_expense_type_id = d.mo_expense_type_id
								 and erp.req_page_element_code = l.req_page_element_code
								 and rt.enabled_flag = 'Y'
								 and re.enabled_flag = 'Y'
								 and e.enabled_flag = 'Y'
								 and et.enabled_flag = 'Y') else (select et.mo_expense_type_id
							from exp_mo_report_type        rt,
								 exp_mo_rep_type_ref_ele   re,
								 exp_report_page_element   e,
								 exp_mo_rep_ele_ref_exp_tp et
						   where rt.mo_exp_report_type_id = #{moExpReportTypeId}
								 and rt.mo_exp_report_type_id = re.mo_exp_report_type_id
								 and re.report_page_element_id = e.report_page_element_id
								 and e.report_page_element_code = #{reportPageElementCode}
								 and re.rep_page_ele_ref_id = et.rep_page_ele_ref_id
								 and et.mo_expense_type_id = d.mo_expense_type_id
								 and rt.enabled_flag = 'Y'
								 and re.enabled_flag = 'Y'
								 and e.enabled_flag = 'Y'
								 and et.enabled_flag = 'Y') end) AS moExpenseTypeId,
                        (select emett.DESCRIPTION from exp_mo_expense_type emet left join exp_mo_expense_type_tl emett on emet.MO_EXPENSE_TYPE_ID = emett.MO_EXPENSE_TYPE_ID and emett.LANG = #{request.locale} where emet.MO_EXPENSE_TYPE_ID = (case when #{reportPageElementCode} is null then (select et.mo_expense_type_id
							from exp_mo_report_type        rt,
								 exp_mo_rep_type_ref_ele   re,
								 exp_report_page_element   e,
								 exp_mo_rep_ele_ref_exp_tp et,
								 exp_req_page_element      erp
						   where rt.mo_exp_report_type_id = #{moExpReportTypeId}
								 and rt.mo_exp_report_type_id = re.mo_exp_report_type_id
								 and re.report_page_element_id = e.report_page_element_id
								 and re.rep_page_ele_ref_id = et.rep_page_ele_ref_id
								 and erp.req_page_element_id = e.req_page_element_id
								 and et.mo_expense_type_id = d.mo_expense_type_id
								 and erp.req_page_element_code = l.req_page_element_code
								 and rt.enabled_flag = 'Y'
								 and re.enabled_flag = 'Y'
								 and e.enabled_flag = 'Y'
								 and et.enabled_flag = 'Y') else (select et.mo_expense_type_id
							from exp_mo_report_type        rt,
								 exp_mo_rep_type_ref_ele   re,
								 exp_report_page_element   e,
								 exp_mo_rep_ele_ref_exp_tp et
						   where rt.mo_exp_report_type_id = #{moExpReportTypeId}
								 and rt.mo_exp_report_type_id = re.mo_exp_report_type_id
								 and re.report_page_element_id = e.report_page_element_id
								 and e.report_page_element_code = #{reportPageElementCode}
								 and re.rep_page_ele_ref_id = et.rep_page_ele_ref_id
								 and et.mo_expense_type_id = d.mo_expense_type_id
								 and rt.enabled_flag = 'Y'
								 and re.enabled_flag = 'Y'
								 and e.enabled_flag = 'Y'
								 and et.enabled_flag = 'Y') end)) AS moExpenseTypeName,
                      (case when #{reportPageElementCode} is null then (select ei.mo_expense_item_id
						from exp_mo_expense_item       ei,
							 exp_mo_report_type        rt,
							 exp_mo_rep_type_ref_ele   re,
							 exp_report_page_element   e,
							 exp_mo_rep_ele_ref_exp_tp et,
							 exp_mo_rep_ele_ref_exp_it rei,
							 exp_req_page_element      erp
					   where ei.mo_req_item_id = d.mo_req_item_id
							 and rt.mo_exp_report_type_id = #{moExpReportTypeId}
							 and rt.mo_exp_report_type_id = re.mo_exp_report_type_id
							 and re.report_page_element_id = e.report_page_element_id
							 and re.rep_page_ele_ref_id = et.rep_page_ele_ref_id
							 and et.exp_type_ref_id = rei.exp_type_ref_id
							 and rei.mo_expense_item_id = ei.mo_expense_item_id
							 and erp.req_page_element_id = e.req_page_element_id
							 and erp.req_page_element_code = l.req_page_element_code
							 and rt.enabled_flag = 'Y'
							 and re.enabled_flag = 'Y'
							 and e.enabled_flag = 'Y'
							 and et.enabled_flag = 'Y'
							 and rei.enabled_flag = 'Y'
							 limit 1) else (select ei.mo_expense_item_id
						from exp_mo_expense_item       ei,
							 exp_mo_report_type        rt,
							 exp_mo_rep_type_ref_ele   re,
							 exp_report_page_element   e,
							 exp_mo_rep_ele_ref_exp_tp et,
							 exp_mo_rep_ele_ref_exp_it rei
					   where ei.mo_req_item_id = d.mo_req_item_id
							 and rt.mo_exp_report_type_id = #{moExpReportTypeId}
							 and rt.mo_exp_report_type_id = re.mo_exp_report_type_id
							 and re.report_page_element_id = e.report_page_element_id
							 and e.report_page_element_code = #{reportPageElementCode}
							 and re.rep_page_ele_ref_id = et.rep_page_ele_ref_id
							 and et.exp_type_ref_id = rei.exp_type_ref_id
							 and rei.mo_expense_item_id = ei.mo_expense_item_id
							 and rt.enabled_flag = 'Y'
							 and re.enabled_flag = 'Y'
							 and e.enabled_flag = 'Y'
							 and et.enabled_flag = 'Y'
							 and rei.enabled_flag = 'Y'
							 limit 1) end) AS moExpenseItemId,
						(select emeit.DESCRIPTION from exp_mo_expense_item emei left join exp_mo_expense_item_tl emeit on emei.MO_EXPENSE_ITEM_ID = emeit.MO_EXPENSE_ITEM_ID and emeit.LANG = #{request.locale} where emei.MO_EXPENSE_ITEM_ID = (case when #{reportPageElementCode} is null then (select ei.mo_expense_item_id
						from exp_mo_expense_item       ei,
							 exp_mo_report_type        rt,
							 exp_mo_rep_type_ref_ele   re,
							 exp_report_page_element   e,
							 exp_mo_rep_ele_ref_exp_tp et,
							 exp_mo_rep_ele_ref_exp_it rei,
							 exp_req_page_element      erp
					   where ei.mo_req_item_id = d.mo_req_item_id
							 and rt.mo_exp_report_type_id = #{moExpReportTypeId}
							 and rt.mo_exp_report_type_id = re.mo_exp_report_type_id
							 and re.report_page_element_id = e.report_page_element_id
							 and re.rep_page_ele_ref_id = et.rep_page_ele_ref_id
							 and et.exp_type_ref_id = rei.exp_type_ref_id
							 and rei.mo_expense_item_id = ei.mo_expense_item_id
							 and erp.req_page_element_id = e.req_page_element_id
							 and erp.req_page_element_code = l.req_page_element_code
							 and rt.enabled_flag = 'Y'
							 and re.enabled_flag = 'Y'
							 and e.enabled_flag = 'Y'
							 and et.enabled_flag = 'Y'
							 and rei.enabled_flag = 'Y'
							 limit 1) else (select ei.mo_expense_item_id
						from exp_mo_expense_item       ei,
							 exp_mo_report_type        rt,
							 exp_mo_rep_type_ref_ele   re,
							 exp_report_page_element   e,
							 exp_mo_rep_ele_ref_exp_tp et,
							 exp_mo_rep_ele_ref_exp_it rei
					   where ei.mo_req_item_id = d.mo_req_item_id
							 and rt.mo_exp_report_type_id = #{moExpReportTypeId}
							 and rt.mo_exp_report_type_id = re.mo_exp_report_type_id
							 and re.report_page_element_id = e.report_page_element_id
							 and e.report_page_element_code = #{reportPageElementCode}
							 and re.rep_page_ele_ref_id = et.rep_page_ele_ref_id
							 and et.exp_type_ref_id = rei.exp_type_ref_id
							 and rei.mo_expense_item_id = ei.mo_expense_item_id
							 and rt.enabled_flag = 'Y'
							 and re.enabled_flag = 'Y'
							 and e.enabled_flag = 'Y'
							 and et.enabled_flag = 'Y'
							 and rei.enabled_flag = 'Y'
							 limit 1) end)) AS moExpenseItemName,
                        d.primary_quantity as primaryQuantity,
                        d.business_currency_code as businessCurrencyCode,
                        (SELECT gc.transaction_precision FROM gld_currency gc where gc.currency_code = d.business_currency_code) AS businessCurrencyPrecision,
                        (SELECT gct.currency_name FROM gld_currency gc LEFT JOIN gld_currency_tl gct ON gc.currency_id = gct.currency_id AND gct.lang = #{request.locale} WHERE gc.currency_code = d.business_currency_code) AS businessCurrencyName,
                        d.biz2pay_exchange_type as biz2payExchangeType,
                        (SELECT gett.description FROM gld_exchangerate_type ge LEFT JOIN gld_exchangerate_type_tl gett ON ge.TYPE_ID = gett.TYPE_ID AND gett.LANG = #{request.locale} where ge.TYPE_CODE = d.biz2pay_exchange_type) AS biz2payExchangeTypeName,
                        d.biz2pay_exchange_rate as biz2payExchangeRate,
                        d.business_price as businessPrice,
                        d.business_amount as businessAmount,
                        d.payment_currency_code as paymentCurrencyCode,
                        (SELECT gc.finance_precision FROM gld_currency gc where gc.currency_code = d.payment_currency_code) AS paymentCurrencyPrecision,
                        (SELECT gct.currency_name FROM gld_currency gc LEFT JOIN gld_currency_tl gct ON gc.currency_id = gct.currency_id AND gct.lang = #{request.locale} WHERE gc.currency_code = d.payment_currency_code) AS paymentCurrencyName,
                        d.pay2fun_exchange_type as pay2funExchangeType,
                        (SELECT gett.description FROM gld_exchangerate_type ge LEFT JOIN gld_exchangerate_type_tl gett ON ge.TYPE_ID = gett.TYPE_ID AND gett.LANG = #{request.locale} where ge.TYPE_CODE = d.pay2fun_exchange_type) AS pay2funExchangeTypeName,
                        d.pay2fun_exchange_rate as pay2funExchangeRate,
                        d.payment_price as paymentPrice,
                        d.payment_amount as paymentAmount,
                        d.management_currency_code as managementCurrencyCode,
                        (SELECT gc.transaction_precision FROM gld_currency gc where gc.currency_code = d.management_currency_code) AS managementCurrencyPrecision,
                        (SELECT gct.currency_name FROM gld_currency gc LEFT JOIN gld_currency_tl gct ON gc.currency_id = gct.currency_id AND gct.lang = #{request.locale} WHERE gc.currency_code = d.management_currency_code) AS managementCurrencyName,
                        d.pay2mag_exchange_type as pay2magExchangeType,
                        (SELECT gett.description FROM gld_exchangerate_type ge LEFT JOIN gld_exchangerate_type_tl gett ON ge.TYPE_ID = gett.TYPE_ID AND gett.LANG = #{request.locale} where ge.TYPE_CODE = d.pay2mag_exchange_type) AS pay2magExchangeTypeName,
                        d.pay2mag_exchange_rate as pay2magExchangeRate,
                        d.management_price as managementPrice,
                        d.management_amount as management_amount,
                        d.requisition_functional_amount as requisitionFunctionalAmount,
                        d.requisition_functional_amount AS reportFunctionalAmount,
                        d.requisition_functional_amount AS functionalAmount,
						(SELECT gc.finance_precision FROM gld_currency gc where gc.currency_code = (select (case when ae.functional_currency_code is null then sob.functional_currency_code else ae.functional_currency_code end) from gld_accounting_entity ae,gld_set_of_book sob where ae.default_set_of_books_id = sob.set_of_books_id and ae.acc_entity_id = d.acc_entity_id)) AS functionalCurrencyPrecision,
                        (case when d.released_amount is null then 0 else d.released_amount end) AS releasedAmount,
                        (case when d.released_quantity is null then 0 else d.released_quantity end) AS releasedQuantity,
                        d.released_status as releasedStatus,
                        greatest(d.payment_amount - (case when d.released_amount is null then 0 else d.released_amount end),0) AS unreleasedAmount,
                        l.dimension1_id as dimension1Id,
                        l.dimension2_id as dimension2Id,
                        l.dimension3_id as dimension3Id,
                        l.dimension4_id as dimension4Id,
                        l.dimension5_id as dimension5Id,
                        l.dimension6_id as dimension6Id,
                        l.dimension7_id as dimension7Id,
                        l.dimension8_id as dimension8Id,
                        l.dimension9_id as dimension9Id,
                        l.dimension10_id as dimension10Id,
                        l.dimension11_id as dimension11Id,
                        l.dimension12_id as dimension12Id,
                        l.dimension13_id as dimension13Id,
                        l.dimension14_id as dimension14Id,
                        l.dimension15_id as dimension15Id,
                        l.dimension16_id as dimension16Id,
                        l.dimension17_id as dimension17Id,
                        l.dimension18_id as dimension18Id,
                        l.dimension19_id as dimension19Id,
                        l.dimension20_id as dimension20Id,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension1_id) AS dimension1Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension2_id) AS dimension2Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension3_id) AS dimension3Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension4_id) AS dimension4Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension5_id) AS dimension5Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension6_id) AS dimension6Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension7_id) AS dimension7Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension8_id) AS dimension8Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension9_id) AS dimension9Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension10_id) AS dimension10Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension11_id) AS dimension11Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension12_id) AS dimension12Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension13_id) AS dimension13Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension14_id) AS dimension14Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension15_id) AS dimension15Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension16_id) AS dimension16Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension17_id) AS dimension17Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension18_id) AS dimension18Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension19_id) AS dimension19Name,
                       (SELECT fdvt.description FROM fnd_dimension_value fdv LEFT JOIN fnd_dimension_value_tl fdvt ON fdv.DIMENSION_VALUE_ID = fdvt.DIMENSION_VALUE_ID AND fdvt.LANG = #{request.locale} where fdv.DIMENSION_VALUE_ID = l.dimension20_id) AS dimension20Name,
                        l.mo_req_item_id as moReqItemId,
                        (select emrit.DESCRIPTION from exp_mo_req_item emri left join exp_mo_req_item_tl emrit on emri.MO_REQ_ITEM_ID = emrit.MO_REQ_ITEM_ID and emrit.LANG = #{request.locale} where emri.MO_REQ_ITEM_ID =  l.mo_req_item_id) AS moReqItemName,
                        l.mo_expense_type_id as reqMoExpenseTypeId,
                        (select emett.DESCRIPTION from exp_mo_expense_type emet left join exp_mo_expense_type_tl emett on emet.MO_EXPENSE_TYPE_ID = emett.MO_EXPENSE_TYPE_ID and emett.LANG = #{request.locale} where emet.MO_EXPENSE_TYPE_ID = l.mo_expense_type_id) AS reqMoExpenseTypeName,
                        l.bgt_entity_id as bgtEntityId,
                        (SELECT bet.description FROM bgt_entity be LEFT JOIN bgt_entity_tl bet ON be.entity_id = bet.entity_id AND bet.lang = #{request.locale} WHERE be.entity_id = l.bgt_entity_id) AS bgtEntityName,
                        l.bgt_center_id as bgtCenterId,
                        (SELECT bct.description FROM bgt_center bc LEFT JOIN bgt_center_tl bct ON bc.center_id = bct.center_id AND bct.lang = #{request.locale} WHERE bc.center_id = l.bgt_center_id) AS bgtCenterName,
                        l.req_page_element_code as reqPageElementCode,
                       	(select srb.url
                           from sys_resource_b srb
                          where exists(select 1
                                         from exp_req_page_element pe
                                        where pe.readonly_service_id = srb.resource_id
                                          and exists (select 1
                                                        from exp_mo_req_type_ref_ele e
                                                       where e.req_page_element_id = pe.req_page_element_id
                                                         and e.mo_exp_req_type_id = (select erh.mo_exp_req_type_id from exp_requisition_header erh where erh.exp_requisition_header_id = h.exp_requisition_header_id)
                                                         and e.enabled_flag = 'Y'
                                                         and e.doc_type_code = 'HEADER')
                                          and pe.enabled_flag = 'Y')) as readonlyServiceName,
                        rtl.travel_line_id as travelLineId,
                        rtl.travel_line_category as travelLineCategory,
                        rtl.transportation,
						(SELECT scv.MEANING FROM sys_code_value_b scv LEFT JOIN sys_code_b sc ON scv.code_id = sc.code_id WHERE scv.VALUE = rtl.transportation AND sc.CODE = 'TRANSPORTATION') as transportationName,
                        rtl.seat_class as seatClass,
                        (case rtl.transportation
						when 'SEATS_HSR_EMU' then (SELECT scv.MEANING FROM sys_code_value_b scv LEFT JOIN sys_code_b sc ON scv.code_id = sc.code_id WHERE scv.VALUE = rtl.seat_class AND sc.CODE = 'SEATS_HSR_EMU')
						when 'SEATS_PLANE' then (SELECT scv.MEANING FROM sys_code_value_b scv LEFT JOIN sys_code_b sc ON scv.code_id = sc.code_id WHERE scv.VALUE = rtl.seat_class AND sc.CODE = 'SEATS_PLANE')
						when 'SEATS_SHIPS' then (SELECT scv.MEANING FROM sys_code_value_b scv LEFT JOIN sys_code_b sc ON scv.code_id = sc.code_id WHERE scv.VALUE = rtl.seat_class AND sc.CODE = 'SEATS_SHIPS')
						when 'SEATS_TRAIN' then (SELECT scv.MEANING FROM sys_code_value_b scv LEFT JOIN sys_code_b sc ON scv.code_id = sc.code_id WHERE scv.VALUE = rtl.seat_class AND sc.CODE = 'SEATS_TRAIN')
						when 'SEATS_CAR' then (SELECT scv.MEANING FROM sys_code_value_b scv LEFT JOIN sys_code_b sc ON scv.code_id = sc.code_id WHERE scv.VALUE = rtl.seat_class AND sc.CODE = 'SEATS_CAR')
						else null end) as seatClassName,
                        rtl.departure_place as departurePlaceName,
                        rtl.departure_place_id as departurePlaceId,
                        DATE_FORMAT(rtl.departure_date, '%Y-%m-%d') as departureDate,
                        rtl.arrival_place as arrivalPlaceName,
                        rtl.arrival_place_id as arrivalPlaceId,
                        DATE_FORMAT(rtl.arrival_date, '%Y-%m-%d') as arrivalDate,
                        DATE_FORMAT(rtl.accommodation_date_from, '%Y-%m-%d') as accommodationDateFrom,
                        DATE_FORMAT(rtl.accommodation_date_to, '%Y-%m-%d') as accommodationDateTo,
                        rtl.accommodation_days as accommodationDays,
                        rtl.peer_people as peerPeopleName,
                        l.entertain_object as entertainObject,
                        l.entertain_number as entertainNumber,
                        rtl.monopolize_flag as monopolizeFlag,
                        h.requisition_date as requisitionDate
                    FROM
                        exp_requisition_dist d,
                        exp_requisition_line l left join exp_requisition_travel_line rtl on l.exp_requisition_line_id   = rtl.exp_requisition_line_id,
                        exp_requisition_header h
                    WHERE
                        l.exp_requisition_line_id   = d.exp_requisition_line_id AND
                        h.requisition_status        = 'COMPLETELY_APPROVED' AND
                        l.exp_requisition_header_id = h.exp_requisition_header_id AND
                        h.exp_requisition_header_id = (case when #{expRequisitionHeaderId} is null then h.exp_requisition_header_id else #{expRequisitionHeaderId} end) AND
                        d.close_flag                = 'N' AND
                        (case when h.reversed_flag is null then 'N' else h.reversed_flag end)    = 'N' AND
                        h.mo_exp_req_type_id       IN
                        (SELECT
                            rt.mo_exp_req_type_id
                        FROM
                            exp_mo_report_type rt
                        WHERE
                            rt.mo_exp_report_type_id = #{moExpReportTypeId}
                        ) AND
                        h.company_id  = #{request.companyId} AND
                        (
                            (case when #{uncompletelyReleasedFlag} is null then 'N' else #{uncompletelyReleasedFlag} end) = 'N' OR
                            (case when d.released_status is null then 'N' else d.released_status end)             != 'C'
                        )
                        AND
                        d.payment_currency_code                                 = #{paymentCurrencyCode} AND
                        greatest(d.payment_amount - (case when d.released_amount is null then 0 else d.released_amount end),0) >0 AND
                        (
                            (
                                EXISTS
                                (SELECT
                                    1
                                FROM
                                    exp_requisition_travel_line tl
                                WHERE
                                    tl.exp_requisition_line_id = l.exp_requisition_line_id AND
                                    tl.monopolize_flag         = (case when #{monopolizeFlag} is null then tl.monopolize_flag else #{monopolizeFlag} end)
                                )
                            )
                            OR
                            (
                                NOT EXISTS
                                (SELECT
                                    1
                                FROM
                                    exp_requisition_travel_line tl
                                WHERE
                                    tl.exp_requisition_line_id = l.exp_requisition_line_id
                                )
                            )
                        )
                        AND
                        l.req_page_element_code = (case when #{reportPageElementCode} is null then l.req_page_element_code else (SELECT
                        r.req_page_element_code
                        FROM
                            exp_report_page_element e,
                            exp_req_page_element r
                        WHERE
                            e.req_page_element_id     =r.req_page_element_id AND
                            e.report_page_element_code=#{reportPageElementCode}
                        ) end) AND
                        NOT EXISTS
                        (SELECT
                            1
                        FROM
                            exp_mo_req_type em
                        WHERE
                            em.mo_exp_req_type_id = h.mo_exp_req_type_id AND
                            (
                                em.one_off_flag ='Y' AND
                                EXISTS
                                (SELECT
                                    1
                                FROM
                                    exp_requisition_release rr
                                WHERE
                                    rr.exp_requisition_line_id=l.exp_requisition_line_id
                                )
                            )
                        )
						ORDER BY
							h.exp_requisition_number DESC,
							l.line_number
    </select>
</mapper>